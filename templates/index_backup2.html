<!DOCTYPE html>
<html>
<head>
    <title>Quantum Bit Generator</title>
    <style>
        body { 
            margin: 0; 
            overflow: hidden; 
            background: linear-gradient(135deg, #e8f4fd 0%, #d3cedc 100%);  /* Pale blue to lavender */
            cursor: url('data:image/svg+xml;utf8,<svg xmlns="http://www.w3.org/2000/svg" width="20" height="20"><circle cx="10" cy="10" r="2" fill="%23b794f6"/><ellipse cx="10" cy="10" rx="8" ry="3" fill="none" stroke="%235a67d8" stroke-width="1"/><ellipse cx="10" cy="10" rx="3" ry="8" fill="none" stroke="%235a67d8" stroke-width="1"/></svg>') 10 10, auto;
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
        }
        body:active {
            cursor: url('data:image/svg+xml;utf8,<svg xmlns="http://www.w3.org/2000/svg" width="20" height="20"><circle cx="10" cy="10" r="2" fill="%23b794f6"/><ellipse cx="10" cy="10" rx="8" ry="3" fill="none" stroke="%235a67d8" stroke-width="1"/><ellipse cx="10" cy="10" rx="3" ry="8" fill="none" stroke="%235a67d8" stroke-width="1"/></svg>') 10 10, auto;
        }
        canvas { display: block; }
        
        /* Force atom cursor everywhere except text inputs */
        * {
            cursor: url('data:image/svg+xml;utf8,<svg xmlns="http://www.w3.org/2000/svg" width="20" height="20"><circle cx="10" cy="10" r="2" fill="%23b794f6"/><ellipse cx="10" cy="10" rx="8" ry="3" fill="none" stroke="%235a67d8" stroke-width="1"/><ellipse cx="10" cy="10" rx="3" ry="8" fill="none" stroke="%235a67d8" stroke-width="1"/></svg>') 10 10, auto !important;
        }

        /* Text cursor only for input fields */
        #code-input, textarea {
            cursor: text !important;
        }

        /* Atom cursor for all terminal elements */
        #terminal-container,
        #terminal-header,
        #terminal-body,
        #terminal-output,
        .terminal-buttons,
        .btn,
        .terminal-title,
        #code-container,
        #code-header,
        #code-body {
            cursor: url('data:image/svg+xml;utf8,<svg xmlns="http://www.w3.org/2000/svg" width="20" height="20"><circle cx="10" cy="10" r="2" fill="%23b794f6"/><ellipse cx="10" cy="10" rx="8" ry="3" fill="none" stroke="%235a67d8" stroke-width="1"/><ellipse cx="10" cy="10" rx="3" ry="8" fill="none" stroke="%235a67d8" stroke-width="1"/></svg>') 10 10, auto !important;
        }

        /* Atom cursor for canvas and 3D elements */
        canvas {
            cursor: url('data:image/svg+xml;utf8,<svg xmlns="http://www.w3.org/2000/svg" width="20" height="20"><circle cx="10" cy="10" r="2" fill="%23b794f6"/><ellipse cx="10" cy="10" rx="8" ry="3" fill="none" stroke="%235a67d8" stroke-width="1"/><ellipse cx="10" cy="10" rx="3" ry="8" fill="none" stroke="%235a67d8" stroke-width="1"/></svg>') 10 10, auto !important;
        }
        
        /* Code Input Container */
        #code-container {
            position: absolute;
            left: 50px;
            top: 30px;
            width: 35%;
            height: 45%;
            background: rgba(232, 244, 253, 0.95);
            border-radius: 12px;
            font-family: 'Courier New', monospace;
            box-shadow: 0 8px 32px rgba(138, 143, 244, 0.3);
            backdrop-filter: blur(10px);
            display: flex;
            flex-direction: column;
            z-index: 1000;
            border: 2px solid rgba(200, 216, 240, 0.8);
        }

        #code-header {
            background: linear-gradient(135deg, #d6e7ff 0%, #e1d5f7 100%);
            padding: 12px 18px;
            border-radius: 12px 12px 0 0;
            display: flex;
            align-items: center;
            justify-content: space-between;
            border-bottom: 1px solid rgba(200, 216, 240, 0.6);
            box-shadow: 0 2px 8px rgba(138, 143, 244, 0.1);
        }

        .code-title {
            color: #5a67d8;
            font-size: 13px;
            font-weight: bold;
            text-shadow: 0 1px 2px rgba(255, 255, 255, 0.5);
        }

        #code-body {
            flex: 1;
            padding: 18px;
            background: linear-gradient(135deg, #f7faff 0%, #faf5ff 100%);
            border-radius: 0 0 12px 12px;
            display: flex;
            flex-direction: column;
            overflow: hidden;
        }

        #code-input {
            flex: 1;
            background: rgba(255, 255, 255, 0.9);
            border: 1px solid rgba(214, 231, 255, 0.8);
            border-radius: 8px;
            padding: 12px;
            font-family: 'Courier New', monospace;
            font-size: 13px;
            color: #4a5568;
            resize: none;
            outline: none;
            box-shadow: 0 2px 8px rgba(138, 143, 244, 0.1);
            margin-bottom: 10px;
        }

        #code-input::placeholder {
            color: #a0aec0;
        }

        #run-button {
            background: linear-gradient(135deg, #8b5cf6 0%, #5a67d8 100%);
            color: white;
            border: none;
            padding: 10px 20px;
            border-radius: 6px;
            font-family: 'Courier New', monospace;
            font-size: 12px;
            font-weight: bold;
            cursor: url('data:image/svg+xml;utf8,<svg xmlns="http://www.w3.org/2000/svg" width="20" height="20"><circle cx="10" cy="10" r="2" fill="%23b794f6"/><ellipse cx="10" cy="10" rx="8" ry="3" fill="none" stroke="%235a67d8" stroke-width="1"/><ellipse cx="10" cy="10" rx="3" ry="8" fill="none" stroke="%235a67d8" stroke-width="1"/></svg>') 10 10, auto !important;
            box-shadow: 0 4px 12px rgba(139, 92, 246, 0.3);
            transition: all 0.2s ease;
        }

        #run-button:hover {
            background: linear-gradient(135deg, #7c3aed 0%, #4f46e5 100%);
            transform: translateY(-1px);
            box-shadow: 0 6px 16px rgba(139, 92, 246, 0.4);
        }

        /* Terminal Output Container */
        #terminal-container {
            position: absolute;
            left: 50px;
            bottom: 30px;
            width: 35%;
            height: 45%;
            background: rgba(232, 244, 253, 0.95);
            border-radius: 12px;
            font-family: 'Courier New', monospace;
            box-shadow: 0 8px 32px rgba(138, 143, 244, 0.3);
            backdrop-filter: blur(10px);
            display: flex;
            flex-direction: column;
            z-index: 1000;
            border: 2px solid rgba(200, 216, 240, 0.8);
        }

        #terminal-header {
            background: linear-gradient(135deg, #d6e7ff 0%, #e1d5f7 100%);
            padding: 12px 18px;
            border-radius: 12px 12px 0 0;
            display: flex;
            align-items: center;
            justify-content: space-between;
            border-bottom: 1px solid rgba(200, 216, 240, 0.6);
            box-shadow: 0 2px 8px rgba(138, 143, 244, 0.1);
        }

        .terminal-buttons {
            display: flex;
            gap: 8px;
        }

        .btn {
            width: 14px;
            height: 14px;
            border-radius: 50%;
            box-shadow: 0 2px 4px rgba(0, 0, 0, 0.1);
        }

        .terminal-title {
            color: #5a67d8;
            font-size: 13px;
            font-weight: bold;
            text-shadow: 0 1px 2px rgba(255, 255, 255, 0.5);
        }

        #terminal-body {
            flex: 1;
            padding: 18px;
            background: linear-gradient(135deg, #f7faff 0%, #faf5ff 100%);
            border-radius: 0 0 12px 12px;
            display: flex;
            flex-direction: column;
            overflow: hidden;
        }

        #terminal-output {
            flex: 1;
            color: #4a5568;
            font-size: 13px;
            line-height: 1.5;
            overflow-y: auto;
            white-space: pre-wrap;
            background: rgba(255, 255, 255, 0.7);
            padding: 12px;
            border-radius: 8px;
            border: 1px solid rgba(226, 232, 240, 0.8);
            box-shadow: inset 0 2px 4px rgba(138, 143, 244, 0.05);
        }

        /* Enhanced scrollbar styling */
        #terminal-output::-webkit-scrollbar, #code-input::-webkit-scrollbar {
            width: 8px;
        }

        #terminal-output::-webkit-scrollbar-track, #code-input::-webkit-scrollbar-track {
            background: rgba(232, 244, 253, 0.5);
            border-radius: 4px;
        }

        #terminal-output::-webkit-scrollbar-thumb, #code-input::-webkit-scrollbar-thumb {
            background: linear-gradient(135deg, #c8d8f0 0%, #b794f6 100%);
            border-radius: 4px;
            border: 1px solid rgba(255, 255, 255, 0.2);
        }

        #terminal-output::-webkit-scrollbar-thumb:hover, #code-input::-webkit-scrollbar-thumb:hover {
            background: linear-gradient(135deg, #b794f6 0%, #8b5cf6 100%);
        }

        /* Display Panel */
        #display-panel {
            position: absolute;
            right: 50px;
            top: 30px;
            bottom: 30px;
            left: 45%;
            background: rgba(232, 244, 253, 0.95);
            border-radius: 12px;
            box-shadow: 0 8px 32px rgba(138, 143, 244, 0.3);
            backdrop-filter: blur(10px);
            border: 2px solid rgba(200, 216, 240, 0.8);
            display: flex;
            flex-direction: column;
            z-index: 500;
        }

        #display-header {
            background: linear-gradient(135deg, #d6e7ff 0%, #e1d5f7 100%);
            padding: 12px 18px;
            border-radius: 12px 12px 0 0;
            display: flex;
            align-items: center;
            justify-content: center;
            border-bottom: 1px solid rgba(200, 216, 240, 0.6);
            box-shadow: 0 2px 8px rgba(138, 143, 244, 0.1);
        }

        #display-body {
            flex: 1;
            position: relative;
            overflow: hidden;
            border-radius: 0 0 12px 12px;
            background: linear-gradient(135deg, #f7faff 0%, #faf5ff 100%);
        }

        #canvas-container {
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
        }

        #welcome-message {
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            text-align: center;
            color: #5a67d8;
            font-size: 18px;
            font-weight: 300;
            opacity: 0.7;
        }

        #welcome-message .subtitle {
            font-size: 14px;
            margin-top: 10px;
            color: #8b5cf6;
        }



    </style>
</head>
<body>
    <!-- Code Input Container -->
    <div id="code-container">
        <div id="code-header">
            <div class="code-title">Qiskit Code Editor</div>
        </div>
        <div id="code-body">
            <textarea id="code-input" placeholder="# Enter your Qiskit code here
from qiskit import QuantumCircuit, execute, Aer

# Example:
qc = QuantumCircuit(1, 1)
qc.h(0)  # Hadamard gate
qc.measure_all()"></textarea>
            <button id="run-button">▶ Run Code</button>
        </div>
    </div>

    <!-- Terminal Output Container -->
    <div id="terminal-container">
        <div id="terminal-header">
            <div class="terminal-title">Output Terminal</div>
        </div>
        <div id="terminal-body">
            <div id="terminal-output"></div>
        </div>
    </div>

    <!-- ADD THIS NEW SECTION HERE -->
    <!-- Display Panel -->
    <div id="display-panel">
        <div id="display-header">
            <div class="panel-title">Quantum State Visualization</div>
        </div>
        <div id="display-body">
            <div id="canvas-container">
                <div id="welcome-message">
                    <div>Welcome to Quantum Visualizer</div>
                    <div class="subtitle">Run Qiskit code to see quantum states on the Bloch sphere</div>
                </div>
            </div>
        </div>
    </div>


    <!-- Load Three.js -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/three.js/r128/three.min.js"></script>
    
    <script>

        async function runQiskitCode(code) {
            try {
                const response = await fetch('/api/quantum/execute', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                    },
                    body: JSON.stringify({ code: code })
                });
                const data = await response.json();
                
                if (data.success) {
                    addToTerminal(`Code executed successfully`);
                    if (data.output) {
                        addToTerminal(`Output: ${data.output}`);
                    }
                    // FIX: Handle the quantum_states array instead of new_state
                    if (data.quantum_states && data.quantum_states.length > 0) {
                        addToTerminal(`Quantum state updated: x=${data.quantum_states[0].x.toFixed(3)}, y=${data.quantum_states[0].y.toFixed(3)}, z=${data.quantum_states[0].z.toFixed(3)}`);
                        // When you're ready: animateArrowTo(data.quantum_states[0]);
                    }
                } else {
                    addToTerminal(`Error: ${data.error}`, true);
                }
            } catch (error) {
                addToTerminal(`Connection error: ${error.message}`, true);
            }
        }

        // Terminal functionality (output only)
        const terminalOutput = document.getElementById('terminal-output');
        const codeInput = document.getElementById('code-input');
        const runButton = document.getElementById('run-button');

        function addToTerminal(text, isError = false) {
            const timestamp = new Date().toLocaleTimeString();
            const prefix = `[${timestamp}] `;
            const color = isError ? 'color: #e53e3e;' : '';
            terminalOutput.innerHTML += `<span style="${color}">${prefix}${text}</span>\n`;
            terminalOutput.scrollTop = terminalOutput.scrollHeight;
        }

        // Run button click handler
        runButton.addEventListener('click', async () => {
            const code = codeInput.value.trim();
            if (code) {
                addToTerminal(`Executing Qiskit code...`);
                await runQiskitCode(code);
            } else {
                addToTerminal('No code to execute', true);
            }
        });

        // Ctrl+Enter to run code
        codeInput.addEventListener('keydown', (event) => {
            if (event.ctrlKey && event.key === 'Enter') {
                runButton.click();
            }
        });

        // Welcome message
        addToTerminal('Qiskit Quantum Simulator Ready');
        addToTerminal('Enter your Qiskit code above and click "Run Code" or press Ctrl+Enter');
    </script>
</body>
</html>